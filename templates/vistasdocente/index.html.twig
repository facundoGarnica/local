{% extends 'base.html.twig' %}

{% block title %}DOCENTES{% endblock %}

{% block javascripts %}
    {{ parent() }}

    {# Script para dirigir a la cursada seleccionada y poder asignar las notas #}

        
    <!-- SheetJS (para Excel) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.1/xlsx.full.min.js"></script>
    
    <!-- jsPDF (para PDF) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
        <!-- html2canvas (para jsPDF) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    {# Script para dirigir a la cursada seleccionada y pasar Asistencia #}
        <script>
           

    function obtenerFechaActual() {
        const hoy = new Date();
        const dia = String(hoy.getDate()).padStart(2, '0');
        const mes = String(hoy.getMonth() + 1).padStart(2, '0');
        const anio = String(hoy.getFullYear()).slice(-2); // Obtener solo los 칰ltimos dos d칤gitos del a침o
        return `${dia}-${mes}-${anio}`;
     }

    // Funci칩n para descargar como Excel
    function DescargarExcel() {
        // Obtener el contenido HTML de la tabla
        const tablaHTML = document.querySelector("#EstadisticasModal");
    
        // Eliminar la fecha de la tabla antes de exportarla
        const fechaElement = document.querySelector('.Fechadehoy');
        const fechaOriginal = fechaElement.textContent;  // Guardar la fecha original si quieres restaurarla despu칠s
        fechaElement.textContent = '';  // Limpiar la fecha para que no se imprima en Excel
    
        // Convertir la tabla HTML a un libro de Excel
        const wb = XLSX.utils.table_to_book(tablaHTML);
    
        // Restaurar la fecha original despu칠s de convertir la tabla
        fechaElement.textContent = fechaOriginal;
    
        // Obtener la fecha actual para a침adirla al nombre del archivo
        const fechaActual = obtenerFechaActual();
    
        // Exportar el archivo Excel con la fecha actual en el nombre
        XLSX.writeFile(wb, `estadisticas_curso_${fechaActual}.xlsx`);
    }
    
    
    // Funci칩n para descargar como PDF
    function DescargarPdf() {
        // Crear un nuevo documento PDF con jsPDF en orientaci칩n horizontal (landscape)
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('landscape', 'mm', 'a4'); // A4 horizontal
        
        // Obtener la fecha actual
        const fechaActual = obtenerFechaActual();
        
        // Seleccionar la tabla que deseas exportar
        const tabla = document.querySelector("#EstadisticasModal");
        
        // Configurar m치rgenes y escala
        const margenIzquierdo = 10;
        const margenSuperior = 10;
        
        // Usar html2canvas para capturar la tabla como imagen
        html2canvas(tabla, {
            scale: 1.2, // Reducir la escala para ajustar mejor la tabla al PDF
        }).then((canvas) => {
            const imgData = canvas.toDataURL("image/png");
        
            // Calcular el ancho y alto de la imagen en mm
            const imgWidth = doc.internal.pageSize.width - margenIzquierdo * 2;
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
        
            // Ajustar la imagen al tama침o de la p치gina
            doc.addImage(imgData, "PNG", margenIzquierdo, margenSuperior, imgWidth, imgHeight);
        
            // Guardar el archivo PDF
            doc.save(`estadisticas_curso_${fechaActual}.pdf`);
        });
    }
    
    
    



    let VistaAsistenciaActiva = false; // Variable para controlar que no se pueda pasar lista sin abrir el modal
    
    function ActivarEstadoAsistencia() {
        VistaAsistenciaActiva = true; // Cambia el estado de VistaAsistenciaActiva
        console.log("VistaAsistenciaActiva:", VistaAsistenciaActiva); // Muestra el estado actual en la consola
    }
    function DesactivarEstadoAsistencia() {
        VistaAsistenciaActiva = false; // Cambia el estado de VistaAsistenciaActiva
        console.log("VistaAsistenciaActiva:", VistaAsistenciaActiva); // Muestra el estado actual en la consola
    }

         function showListaNueva(cursoId) {
        selectedCursoId = cursoId;
        console.log("Curso ID recibido:", cursoId);
    
        // Oculta la lista de profesores y asignaturas
        const listaProfesores = document.getElementById('tablaTecnicaturas');
        if (listaProfesores) {
            listaProfesores.style.display = 'none';
        }
    
        const curso = cursosData[cursoId];
        
        if (curso) {
            // Actualiza el t칤tulo y la informaci칩n del curso
           // document.querySelector('.curso-titulo').textContent = curso.asignatura;
            document.querySelector('.curso-info h2 span').textContent = curso.asignatura;
            document.querySelector('.curso-info h3 span:nth-child(1)').textContent = curso.anio;
            document.querySelector('.curso-info h3 span:nth-child(2)').textContent = curso.comision;
    
            const tbody = document.querySelector('.curso-tabla tbody');
            tbody.innerHTML = ''; // Limpia la tabla antes de agregar nuevas filas
    
            let presentes = 0;
    
            curso.cursadas.forEach(cursada => {
                const alumno = cursada.alumno;
                const ultimaAsistencia = cursada.asistencias.length > 0
                    ? cursada.asistencias[cursada.asistencias.length - 1]
                    : null;
    
                const row = document.createElement('tr');
                row.classList.add('fila-alumno');
    
                row.innerHTML = `
                    <td class="alumno-nombre">${alumno.nombre}</td>
                    <td class="alumno-apellido">${alumno.apellido}</td>
                    <td class="alumno-dni">${alumno.dni}</td>
                    <td class="alumno-asistencia">
                        <span class="estado-asistencia ${ultimaAsistencia ? ultimaAsistencia.asistencia.toLowerCase() : 'no-marcado'}">
                            ${ultimaAsistencia ? ultimaAsistencia.asistencia : 'No marcado'}
                        </span>
                    </td>
                    <td class="alumno-observacion">${ultimaAsistencia ? ultimaAsistencia.observacion : ''}</td>
                    <td class="alumnoeditar">
                          <button onclick="ActivarEstadoEditar();editarAsistencia(${cursoId}, ${cursada.id})">Editar</button>
                          
                    </td>
                `;
    
                tbody.appendChild(row);
    
                if (ultimaAsistencia && ultimaAsistencia.asistencia.toLowerCase() === 'presente') {
                    presentes++;
                }
            });
    
            // Actualiza el total de presentes
            const totalPresentes = document.querySelector('.total-presentes');
            if (totalPresentes) {
                totalPresentes.textContent = `Alumnos presentes: ${presentes}`;
            }
    
            // Muestra la tabla
            document.getElementById('ListaNueva').style.display = 'block';
        } else {
            console.error("No se encontr칩 el curso con ID:", cursoId);
        }
    }
        let modalAbierto = false;

          
                        function abrirPasarAsistenciaModal() {
                    if (modalAbierto) {
                        console.log('El modal ya est치 abierto.');
                        return; // Evita abrir el modal si ya est치 abierto
                    }
                
                    // Reiniciar el 칤ndice del array
                    indiceActual = 0;
                
                    // Mostrar overlay y modal
                    document.getElementById('spa-overlay').style.display = 'block';
                    document.getElementById('PasarAsistenciaModal').style.display = 'block';
                
                    // Cargar el primer alumno
                    mostrarAlumno(indiceActual);
                
                    // Cambiar el estado del modal a abierto
                    modalAbierto = true;
                }
        
                    function editarAsistencia(cursoId, cursadaId) {
        fetch(`/local/public/index.php/actualizar-lista-alumnos/${cursoId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error al obtener los datos actualizados');
                }
                return response.json();
            })
            .then(data => {
                const cursadaIndex = cursosData[cursoId].cursadas.findIndex(c => c.id === cursadaId);
                if (cursadaIndex === -1) {
                    console.error("No se encontr칩 la cursada con ID:", cursadaId);
                    return;
                }
    
                // Actualiza el 칤ndice actual al del alumno que se est치 editando
                indiceActual = cursadaIndex;
    
                const cursada = cursosData[cursoId].cursadas[cursadaIndex];
                const alumno = cursada.alumno;
                const ultimaAsistencia = cursada.asistencias.length > 0
                    ? cursada.asistencias[cursada.asistencias.length - 1]
                    : null;
    
                const alumnoNombreElemento = document.querySelector('.AlumnoNombre');
                const alumnoDniElemento = document.querySelector('.AlumnoDni');
                const spanEstado = document.querySelector('.estado-text');
                const observacionInput = document.getElementById('observacion-input');
    
                if (alumnoNombreElemento && alumnoDniElemento) {
                    alumnoNombreElemento.textContent = `${alumno.nombre} ${alumno.apellido}`;
                    alumnoDniElemento.textContent = `DNI: ${alumno.dni}`;
                }
    
                if (ultimaAsistencia) {
                    spanEstado.textContent = ultimaAsistencia.asistencia;
                    spanEstado.className = 'estado-text estado-' + ultimaAsistencia.asistencia.toLowerCase().replace(' ', '');
                    observacionInput.value = ultimaAsistencia.observacion || '';
                } else {
                    spanEstado.textContent = 'No marcado';
                    spanEstado.className = 'estado-text estado-neutral';
                    observacionInput.value = '';
                }
    
                document.getElementById('spa-overlay').style.display = 'block';
                document.getElementById('PasarAsistenciaModal').style.display = 'block';
                modalAbierto = true;
            })
            .catch(error => console.error('Error al cargar los datos del alumno:', error));
    }


    function showCursoCursada(cursoId) {
        // oculta tablas no relevantes
        let tablesToHide = document.querySelectorAll('.tabla_home, .tabla_comision, .tabla_cursada, .tabla_curso');
        tablesToHide.forEach(table => table.style.display = 'none');

        // oculta cursos
        let cursadaTables = document.querySelectorAll('.tabla_curso');
        cursadaTables.forEach(table => table.style.display = 'none');

        // muestra tabla cursada espec칤fica
        let cursadaTable = document.getElementById(`tablaCursoCursada_${cursoId}`);
        if (cursadaTable) {
            cursadaTable.style.display = '';
        }

        // ocultar search
        let search = document.getElementById('searchs');
        if (search) {
            search.style.display = 'none';
        }

        // muestra el bot칩n de regresar, la funci칩n hide... recibe id de comision, tecnicatura y asignatura para poder regresar al punto anterior
        let backButton = document.getElementById('backButton');
        if (backButton) {
            backButton.style.display = '';
            backButton.onclick = function() {
                hideCursoCursada(cursoId);
            };
        }
    }
    function hideCursoCursada(cursoId) {
        // oculta tabla cursada espec칤fica
        let cursadaTable = document.getElementById(`tablaCursoCursada_${cursoId}`);
        if (cursadaTable) {
            cursadaTable.style.display = 'none';
        }

        // muestra la tabla curso espec칤fica
        let cursoTable = document.getElementById(`tablaTecnicaturas`);
        if (cursoTable) {
            cursoTable.style.display = '';
        }

        // oculta el bot칩n regresar-volver
        let backButton = document.getElementById('backButton');
        if (backButton) {
            backButton.style.display = 'none';
        }
    }
        // Funci칩n para cerrar el modal
        function cerrarPasarAsistenciaModal() {
            if (!modalAbierto) {
                console.log('El modal ya est치 cerrado.');
                return; // Evita intentar cerrar el modal si ya est치 cerrado
            }
        
            // Ocultar overlay y modal
            document.getElementById('spa-overlay').style.display = 'none';
            document.getElementById('PasarAsistenciaModal').style.display = 'none';
        
            // Restablecer los valores del modal
            const alumnoNombreElemento = document.querySelector('.AlumnoNombre');
            const alumnoDniElemento = document.querySelector('.AlumnoDni');
            const spanEstado = document.querySelector('.estado-text');
            const observacionInput = document.getElementById('observacion-input');
        
            if (alumnoNombreElemento) alumnoNombreElemento.textContent = 'Nombre Apellido';
            if (alumnoDniElemento) alumnoDniElemento.textContent = 'DNI: 12345678';
            if (spanEstado) {
                spanEstado.textContent = 'No marcado';
                spanEstado.className = 'estado-text estado-neutral';
            }
            if (observacionInput) observacionInput.value = '';
        
            // Cambiar el estado del modal a cerrado
            modalAbierto = false;
            DesactivarEstadoAsistencia();
            DesactivarEstadoEditar();
        }
        document.getElementById('spa-overlay').addEventListener('click', cerrarPasarAsistenciaModal);
        
        // Evento para cerrar el modal cuando se presiona Escape
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && modalAbierto) {
                cerrarPasarAsistenciaModal();  
            }
        });
        
        
        
        
        
  
 
        const cursosData = {
            {% for curso in cursos %}
                {{ curso.id }}: {
                    id: {{ curso.id }},
                    asignatura: "{{ curso.asignatura.nombre|e('js') }}",
                    anio: "{{ curso.comision.anio|e('js') }}",
                    comision: "{{ curso.comision.comision|e('js') }}",
                    tecnicatura: "{{ curso.comision.tecnicatura.nombre|e('js') }}",
                    cursadas: [
                        {% for cursada in curso.cursadas %}
                            {
                                id: {{ cursada.id }},
                                alumno: {
                                    id: {{ cursada.alumno.id }},
                                    nombre: "{{ cursada.alumno.nombre|e('js') }}",
                                    apellido: "{{ cursada.alumno.apellido|e('js') }}",
                                    dni: "{{ cursada.alumno.dniPasaporte|e('js') }}"
                                },
                                asistencias: [
                                    {% for asistencia in cursada.getAsistencias %}
                                        {
                                            id: {{ asistencia.id }},
                                            fecha: "{{ asistencia.fecha|date('Y-m-d') }}",  <!-- Ajuste en el formato de la fecha -->
                                            asistencia: "{{ asistencia.asistencia|e('js') }}",
                                            observacion: "{{ asistencia.observacion|e('js') }}"
                                        }{% if not loop.last %},{% endif %}
                                    {% endfor %}
                                ]
                            }{% if not loop.last %},{% endif %}
                        {% endfor %}
                    ]
                }{% if not loop.last %},{% endif %}
            {% endfor %}
        };
        
        

        //Script para representar la fecha actual en el html , class .fecha-actual
        document.addEventListener('DOMContentLoaded', () => {
            const fechaSpan = document.querySelector('.fecha-actual');
            if (fechaSpan) {
                const hoy = new Date();
                const dia = String(hoy.getDate()).padStart(2, '0');
                const mes = String(hoy.getMonth() + 1).padStart(2, '0');
                const anio = hoy.getFullYear();
                fechaSpan.textContent = `Fecha: ${dia}/${mes}/${anio}`;
            }
        });
                document.addEventListener('DOMContentLoaded', () => {
            // Bot칩n "Presente"
            document.getElementById('presente').addEventListener('click', () => {
                actualizarEstado('Presente', true); // Marca como "Presente" y guarda
                setTimeout(avanzarSiEsPosible, 1000); // Avanza al siguiente alumno despu칠s de 1 segundo
            });
        
            // Bot칩n "Ausente"
            document.getElementById('ausente').addEventListener('click', () => {
                actualizarEstado('Ausente', true); // Marca como "Ausente" y guarda
                setTimeout(avanzarSiEsPosible, 1000); // Avanza al siguiente alumno despu칠s de 1 segundo
            });
        
            // Bot칩n "Media falta"
            document.getElementById('mediafalta').addEventListener('click', () => {
                actualizarEstado('Media falta', true); // Marca como "Media falta" y guarda
                setTimeout(avanzarSiEsPosible, 1000); // Avanza al siguiente alumno despu칠s de 1 segundo
            });
        
            // Bot칩n "Justificada"
            document.getElementById('justificada').addEventListener('click', () => {
                actualizarEstado('Justificada', false); // Marca como "Justificada" pero no guarda autom치ticamente
                document.getElementById('observacion').style.visibility = 'visible';
                document.getElementById('enviar').style.visibility = 'visible';
            });
        });
        
  
        

        
        function hideAsistencia(cursoId) {
            // oculta tabla cursada espec칤fica
            let cursadaTable = document.getElementById(`tablaAsistencia_${cursoId}`);
            if (cursadaTable) {
                cursadaTable.style.display = 'none';
            }

            // muestra la tabla curso espec칤fica
            let cursoTable = document.getElementById(`tablaTecnicaturas`);
            if (cursoTable) {
                cursoTable.style.display = '';
            }

            // oculta el bot칩n regresar-volver
            let backButton = document.getElementById('backButton');
            if (backButton) {
                backButton.style.display = 'none';
            }
        }

        let indiceActual = 0;  // 칈ndice del alumno actual
        let ActivarEditar = false;  // Variable para activar el modo de edici칩n

// Esta funci칩n muestra los datos del alumno en el panel
// Aseg칰rate de que `cursosData` est칠 correctamente cargada antes de acceder a ella
    let selectedCursoId = 1;  // Ejemplo de ID seleccionado, reemplaza con tu l칩gica


    function ActivarEstadoEditar(){
        ActivarEditar = true;  // Cambia el estado de ActivarEditar
        console.log("ActivarEditar:", ActivarEditar);  // Muestra el estado actual en la consola
    }
    function DesactivarEstadoEditar(){
        ActivarEditar = false;  // Cambia el estado de ActivarEditar
        console.log("ActivarEditar:", ActivarEditar);  // Muestra el estado actual en la consola
    }
    // Funci칩n para mostrar el alumno
                    function mostrarAlumno(index) {
                console.log("Llamando a mostrarAlumno con 칤ndice:", index);
            
                if (index < 0 || index >= cursosData[selectedCursoId].cursadas.length) {
                    console.error("칈ndice fuera de rango:", index);
                    return;
                }
            
                const alumno = cursosData[selectedCursoId].cursadas[index].alumno;
                const asistencias = cursosData[selectedCursoId].cursadas[index].asistencias;
            
                console.log("Mostrando alumno:", alumno);
                console.log("Asistencias del alumno:", asistencias);
            
                const alumnoNombreElemento = document.querySelector('.AlumnoNombre');
                const alumnoDniElemento = document.querySelector('.AlumnoDni');
                const spanEstado = document.querySelector('.estado-text');
                const observacionInput = document.getElementById('observacion-input');
            
                if (alumnoNombreElemento && alumnoDniElemento) {
                    alumnoNombreElemento.textContent = `${alumno.nombre} ${alumno.apellido}`;
                    alumnoDniElemento.textContent = `DNI: ${alumno.dni}`;
                } else {
                    console.error("No se pudieron encontrar los elementos para actualizar.");
                }
            
                // Recupera la 칰ltima asistencia del alumno
                const ultimaAsistencia = asistencias.length > 0 ? asistencias[asistencias.length - 1] : null;
            
                if (ultimaAsistencia) {
                    spanEstado.textContent = ultimaAsistencia.asistencia;
                    spanEstado.className = 'estado-text estado-' + ultimaAsistencia.asistencia.toLowerCase().replace(' ', '');
                    observacionInput.value = ultimaAsistencia.observacion || '';
                } else {
                    // Si no hay asistencias, restablece los valores por defecto
                    spanEstado.textContent = 'No marcado';
                    spanEstado.className = 'estado-text estado-neutral';
                    observacionInput.value = '';
                }
            
                // Siempre oculta el campo de observaciones y el bot칩n "Guardar"
                document.getElementById('observacion').style.visibility = 'hidden';
                document.getElementById('enviar').style.visibility = 'hidden';
            }

    // Funci칩n para avanzar al siguiente alumno
                function avanzarSiEsPosible() {
            if (indiceActual < cursosData[selectedCursoId].cursadas.length - 1) {
                // Avanza al siguiente alumno
                indiceActual++;
                mostrarAlumno(indiceActual);
            } else {
                // Si es el 칰ltimo alumno, cierra el modal despu칠s de 1 segundo
                setTimeout(() => {
                    cerrarPasarAsistenciaModal();
                }, 1000);
            }
        }
    
    function retrocederAlumno() {
        if (indiceActual > 0) {
            indiceActual--;
            mostrarAlumno(indiceActual);
        }
    }
    

    // Cargar el primer alumno al iniciar
    document.addEventListener('DOMContentLoaded', () => {
        mostrarAlumno(indiceActual);
    });

// Asignar el evento al bot칩n "siguiente"
document.getElementById('siguiente').addEventListener('click', avanzarSiEsPosible);
document.getElementById('anterior').addEventListener('click', retrocederAlumno);

// Aseg칰rate de que el primer alumno se cargue al principio
document.addEventListener('DOMContentLoaded', () => {
    mostrarAlumno(indiceActual);  // Cargar el primer alumno
});
        
        
        function hideListaNueva(cursoId) {
            // Oculta ListaNueva
            let lista = document.getElementById('ListaNueva');
            if (lista) {
                lista.style.display = 'none';
            }
        
            // Mostrar algo al volver (por ejemplo, una tabla general)
            let tablaPrincipal = document.getElementById('tablaTecnicaturas');
            if (tablaPrincipal) {
                tablaPrincipal.style.display = '';
            }
        
            // Ocultar el bot칩n volver
            let backButton = document.getElementById('backButton');
            if (backButton) {
                backButton.style.display = 'none';
            }
        }
        

function llenarTablaPorcentaje(cursoId) {
    const curso = cursosData[cursoId];
    const tbody = document.querySelector('#EstadisticasModal tbody');
    tbody.innerHTML = ''; // Limpia la tabla

    if (!curso) return;

    // Obtener la asignatura y la tecnicatura
    const nombreCurso = curso.asignatura || 'Nombre no disponible';  // Manejar caso cuando 'asignatura' no existe
    const tecnicatura = curso.tecnicatura || '---';  // Ahora puedes acceder directamente a 'tecnicatura'
    const anio = curso.anio;
    const comision = curso.comision;

    // Asignar datos al encabezado
    document.querySelector('.nombre-tecnicatura').textContent = tecnicatura;
    document.querySelector('.anio-comision').textContent = `A침o: ${anio}춿 Comisi칩n: ${comision}`;
    document.querySelector('.nombre-asignatura').textContent = nombreCurso;

    // Obtener la fecha actual
    const hoy = new Date();
    const dia = String(hoy.getDate()).padStart(2, '0');
    const mes = String(hoy.getMonth() + 1).padStart(2, '0');
    const anioFecha = hoy.getFullYear();
    const fechaActual = `Fecha: ${dia}/${mes}/${anioFecha}`;

    // Asignar la fecha al elemento con la clase 'Fechadehoy'
    document.querySelector('.Fechadehoy').textContent = fechaActual;

    // Llenar la tabla de alumnos
    curso.cursadas.forEach(cursada => {
        const alumno = cursada.alumno;
        const asistencias = cursada.asistencias;

        let presente = 0;
        let ausente = 0;
        let mediaFalta = 0;
        let justificada = 0;

        asistencias.forEach(a => {
            const tipo = a.asistencia.toLowerCase();
            if (tipo === 'presente') presente++;
            else if (tipo === 'ausente') ausente++;
            else if (tipo === 'media falta') mediaFalta++;
            else if (tipo === 'justificada') justificada++;
        });

        const total = presente + ausente + mediaFalta + justificada;
        const porcentajePresente = total > 0 ? ((presente + mediaFalta * 0.5) / total * 100).toFixed(2) : '0.00';
        const porcentajeAusente = total > 0 ? ((ausente + mediaFalta * 0.5) / total * 100).toFixed(2) : '0.00';
        const porcentajeJustificada = total > 0 ? (justificada / total * 100).toFixed(2) : '0.00';


        const fila = document.createElement('tr');
        fila.innerHTML = `
            <td>${alumno.nombre}</td>
            <td>${alumno.apellido}</td>
            <td>${alumno.dni}</td>
            <td>${presente}</td>
            <td>${ausente}</td>
            <td>${mediaFalta}</td>
            <td>${justificada}</td>
            <td>${total}</td>
            <td>${porcentajePresente}%</td>
            <td>${porcentajeAusente}%</td>
            <td>${porcentajeJustificada}%</td>
        `;
        tbody.appendChild(fila);
    });
}





function abrirPorcentaje() {
    const modal = document.getElementById('modalporcentaje');
    const lista = document.getElementById('ListaNueva');

    if (modal) modal.style.display = 'block';
    if (lista) lista.style.display = 'none';

    if (selectedCursoId !== undefined) {
        llenarTablaPorcentaje(selectedCursoId);
    }
}


function cerrarPorcentaje() {
    const modal = document.getElementById('modalporcentaje');
    const lista = document.getElementById('ListaNueva');

    if (modal) modal.style.display = 'none';
    if (lista) lista.style.display = 'block';
}

    
    </script>

    {# Script para cargar variable si hay sesion iniciada y mantener el punto de pantalla donde se dejo al realizar alguna operacion #}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Evaluar si `comId` est치 definido y no es nulo
            {% if cursoId is defined and cursoId is not null %}
                // Llamar a showCursada con los IDs de cursada y tecnicatura
                showCursoCursada({{ cursoId|default('null') }});
            {% else %}
            {% endif %}

            {% if cursoId2 is defined and cursoId2 is not null %}
                // Llamar a showCursada con los IDs de cursada y tecnicatura
                showAsistencia({{ cursoId2|default('null') }});
            {% else %}
            {% endif %}
        });
    </script>

    {# Filtro necesario para no acceder un docente a todas los cursos, aqui ademas el super-adminitrador puede acceder sin filtro a todos los registros #}
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            var userEmail = "{{ app.user.email }}";  // aqui obtenemos el correo del usuario logueado
            var userDni = userEmail.split('@')[0];  // Extraer el DNI antes del '@'
            
            // Llamar a la funci칩n de filtrado
            if (userEmail !== 'admin@admin.i12') {
                filterTableByDni(userDni);
            }
        });

        function filterTableByDni(dni) {
            // Obtener todas las filas de la tabla
            var rows = document.querySelectorAll("#tablaTecnicaturas tbody tr");
            
            // Recorrer cada fila y mostrar/ocultar seg칰n el DNI
            rows.forEach(function(row) {
                var docenteData = row.querySelector('td:first-child').innerText;  // Obtener el texto del primer <td> (Docente)
                if (docenteData.includes(dni)) {
                    row.style.display = '';  // Mostrar la fila
                } else {
                    row.style.display = 'none';  // Ocultar la fila
                }
            });
        }
    </script>

{% endblock %}


{% block body %}
    <div id="body-vistas">
        <h1 id="vistas">Central Docente/s</h1>
        <table class="tabla_home" id="tablaTecnicaturas" border="1">
            <thead>
                <tr>
                    <th>Docente</th>
                    <th>Asignatura</th>
                    <th>Comision</th>
                    <th>Tecnicatura</th>
                    <th>Asistencias</th>
                    <th>Notas</th>
                </tr>
            </thead>
            <tbody>
            {% for cursada_docente in cursada_docentes %}
                <tr>
                    <td>{{ cursada_docente }}</td>
                    <td>{{ cursada_docente.curso.asignatura.nombre }}</td>
                    <td>{{ cursada_docente.curso.comision }}</td>
                    <td>{{ cursada_docente.curso.comision.tecnicatura }}</td>
                    <td>
                        <button onclick="showListaNueva({{ cursada_docente.curso.id }})" class="btn-primary">Asistencia</button>
                      
                        
                    </td>
                    <td>
                        <button onclick="showCursoCursada({{ cursada_docente.curso.id }})" class="btn-primary">Notas</button>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="4">no records found</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>



        {% for curso in cursos %}
            <table id="tablaCursoCursada_{{ curso.id }}" class="tabla_curso_cursada" style="display: none;" border="1">
                <thead>
                    <tr>
                        <th colspan="4">{{ curso.comision.tecnicatura }} -Cursadas de Curso-</th>
                        <th colspan="3"> A침o: {{ curso.comision.anio }} Comision: {{ curso.comision.comision }}</th>
                    </tr>
                    <tr>
                        <th>Asignatura :</th>
                        <th colspan="6"> {{ curso.asignatura.nombre }} {{ curso.ciclolectivo }}</th>
                    </tr>
                    <tr>    
                        <th>Curso</th>
                        <th>Cursada</th>
                        <th>N1</th>
                        <th>R1</th>
                        <th>N2</th>
                        <th>R2</th>
                        <th>Condicion</th>
                    </tr>
                </thead>
                <tbody>
                    {% for cursada in curso.cursadas %}
                        {% if cursada.curso.ciclolectivo == curso.ciclolectivo %}
                            <tr>
                                <td>{{ curso.ciclolectivo }}</td>
                                <td>{{ cursada.alumno }}</td>
                                <td>
                                    {{ cursada.getNotaId().parcial }}
                                    <button 
                                        onclick="openModal1({{ cursada.getNotaId().id }}, {{ curso.id }}, 'parcial')" 
                                        {% if cursada.getNotaId().parcial is not null %}style="display: none;"{% endif %}
                                    >
                                        Editar
                                    </button>
                                </td>
                                <td>
                                    {{ cursada.getNotaId().recuperatorio1 }}
                                    <button 
                                        onclick="openModal1({{ cursada.getNotaId().id }}, {{ curso.id }}, 'recuperatorio1')" 
                                        {% if cursada.getNotaId().recuperatorio1 is not null %}style="display: none;"{% endif %}
                                    >
                                        Editar
                                    </button>
                                </td>
                                <td>
                                    {{ cursada.getNotaId().parcial2 }}
                                    <button 
                                        onclick="openModal1({{ cursada.getNotaId().id }}, {{ curso.id }}, 'parcial2')" 
                                        {% if cursada.getNotaId().parcial2 is not null %}style="display: none;"{% endif %}
                                    >
                                        Editar
                                    </button>
                                </td>
                                <td>
                                    {{ cursada.getNotaId().recuperatorio2 }}
                                    <button 
                                        onclick="openModal1({{ cursada.getNotaId().id }}, {{ curso.id }}, 'recuperatorio2')" 
                                        {% if cursada.getNotaId().recuperatorio2 is not null %}style="display: none;"{% endif %}
                                    >
                                        Editar
                                    </button>
                                </td>
                                <td>{{ cursada.condicion }}</td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        {% endfor %}



    <script>
       
        
        document.addEventListener('DOMContentLoaded', function() {
            // Generar la fecha actual
            const today = new Date();
            const day = String(today.getDate()).padStart(2, '0');
            const month = String(today.getMonth() + 1).padStart(2, '0');
            const year = today.getFullYear();
            const formattedToday = `${day}-${month}-${year}`; // Esta es la fecha formateada
        
            // Comparar la fecha y actualizar la tabla
            const fechaActual = formattedToday;  // Usa formattedToday aqu칤
        
            document.querySelectorAll('tbody').forEach(tbody => {
                tbody.querySelectorAll('tr').forEach(row => {
                    const fechaAsistencia = row.querySelector('.fecha-asistencia');
                    
                    if (fechaAsistencia) {
                        const asistenciaFecha = fechaAsistencia.textContent.trim();
                        
                        // Verificar si las fechas coinciden
                        if (asistenciaFecha !== fechaActual) {
                            row.style.display = 'none'; // Oculta las filas que no coinciden con la fecha actual
                        } else {
                            row.style.display = ''; // Muestra las filas que coinciden con la fecha actual
                        }
                    }
                });
            });
        });
        
        
    </script>
    <!-- CAMPO DE LA NUEVA LISTA //////////////////////////////////// -->
    <div class="curso-container" id="ListaNueva"style="display: none;">
        <!-- T칤tulo del curso -->
        <!-- <h1 class="curso-titulo">Nombre del Curso</h1> -->
    <div class="curso-info">
        <h2 class="curso-subtitulo">Asignatura: <span>Asignatura Nombre</span></h2>
        <h3 class="curso-subtitulo">A침o: <span>--</span> | Comisi칩n: <span>--</span></h3>
    </div>

        <!-- Contenedor de bot칩n y fecha alineados -->
        <div class="fecha-actual-wrapper">
            <button class="btn-pasar-lista" onclick="abrirPorcentaje()">
                Ver asistencias
            </button>

            <button class="btn-pasar-lista" onclick="abrirPasarAsistenciaModal(); ActivarEstadoAsistencia();">
                游늶 Pasar Lista
            </button>
            

            <span class="fecha-actual">
                Fecha: DD/MM/AAAA
            </span>
            
        </div>

        <!-- Buscar -->
        <div class="buscador-alumno">
            <label for="dni-buscar">Buscar alumno:</label>
            <div class="input-group">
                <input type="text" id="dni-buscar" class="form-control" placeholder="Por DNI..." aria-label="Buscar por DNI">
                <input type="text" id="nombre-buscar" class="form-control" placeholder="Por Nombre..." aria-label="Buscar por Nombre">
                <input type="text" id="apellido-buscar" class="form-control" placeholder="Por Apellido..." aria-label="Buscar por Apellido">
            </div>
        </div>

        <!-- Tabla de alumnos -->
        <div class="tabla-alumnos-wrapper">
            <table class="curso-tabla">
                <thead>
                    <tr>
                        <th class="col-nombre">Nombre</th>
                        <th class="col-apellido">Apellido</th>
                        <th class="col-dni">DNI</th>
                        <th class="col-asistencia">Asistencia</th>
                        <th class="col-observaciones">Observaciones</th>
                        <th class="col-editar">Opciones</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="fila-alumno">
                        <td class="alumno-nombre">Juan</td>
                        <td class="alumno-apellido">P칠rez</td>
                        <td class="alumno-dni">12345678</td>
                        <td class="alumno-asistencia">
                            <span class="estado-asistencia presente"></span>
                        </td>
                    </tr>
                    <tr class="fila-alumno">
                        <td class="alumno-nombre"></td>
                        <td class="alumno-apellido"></td>
                        <td class="alumno-dni"></td>
                        <td class="alumno-asistencia">
                            <span class="estado-asistencia ausente"></span>
                        </td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="6" class="total-presentes">
                            Alumnos presentes: 1
                        </td>
                    </tr>
                </tfoot>
            </table>
        </div>

          <button class="btn-pasar-lista" onclick="hideListaNueva()">
        Volver
    </button>
    </div>
  

    <!-- CAMPO DE LA NUEVA LISTA //////////////////////////////////// -->

        <!-- TABLA DE PORCENTAJE /////// -->
        <div id="modalporcentaje" style="display: none;" >
            <table id="EstadisticasModal" class="tablillacursada" border="1">
                <thead>
                    <tr>
                        <th colspan="6" class="nombre-tecnicatura">Tecnicatura en Inform치tica - Cursadas de Curso -</th>
                        <th colspan="2" class="anio-comision">A침o: 2춿 Comision: A</th>
                        <th colspan="2" class="Fechadehoy"></th>
                    </tr>
                    <tr>
                        <th colspan="2" class="asignatura">
                            Asignatura:
                            <p id="fechatablilla" style="margin: 0;">Abril 2025</p>
                        </th>
                        <th colspan="6" class="nombre-asignatura">Programaci칩n II - Ciclo Lectivo 2025</th>
                        <th colspan="6" class="titulo-porcentaje">Porcentaje de asistencia</th>
                    </tr>
                    <tr>
                        <th>Nombre</th>
                        <th>Apellido</th>
                        <th>Dni</th>
                        <th>Presente</th>
                        <th>Ausente</th>
                        <th>Media falta</th>
                        <th>Justificada</th>
                        <th>Total Asistencias</th>
                        <th>Presente</th>
                        <th>Ausente</th>
                        <th>justificada</th>
                    </tr>
                </thead>
                <tbody>
               
                </tbody>
            </table>
            
            <div class="acciones">
                <button class="botondeporcentaje" onclick="cerrarPorcentaje()">
                    Regresar a la lista
                </button>
                
                <div class="descarga-planilla">
                    <h3>Descargar planilla como:</h3>
                    <div class="botones-descarga">
                        <button class="boton-excel" onclick="DescargarExcel()">Excel</button>
                        <button class="boton-pdf" onclick="DescargarPdf()">PDF</button>
                    </div>
                </div>
            </div>
            
                
        </div>
        <!-- TABLA DE PORCENTAJE /////// -->




        {# script asistencias #}
        <script>
            function openModal3(cursoId, cursadaId, asistenciaId) {
                // Generar la URL con los IDs correctos
                const url = "{{ path('editar_asistencias', { 'id': '__id__', 'curso_id': '__cursoId__' }) }}"
                    .replace('__id__', asistenciaId)
                    .replace('__cursoId__', cursoId);
                // Realizar la solicitud fetch
                fetch(url)
                    .then(response => response.text())
                    .then(html => {
                        document.getElementById('modalBody-1').innerHTML = html;
                        document.getElementById('Modal1').style.display = 'block';
                            //asistencia_asistencia    asistencia_fecha       asistencia_observacion     asistencia_cursada

                        // Configurar la fecha actual en los campos de mes, d칤a y a침o
                        const today = new Date();
                        const dayInput = document.querySelector('#asistencia_fecha_day');
                        const monthInput = document.querySelector('#asistencia_fecha_month');
                        const yearInput = document.querySelector('#asistencia_fecha_year');

                        if (dayInput) {
                            dayInput.value = today.getDate();
                        }
                        if (monthInput) {
                            monthInput.value = today.getMonth() + 1;
                        }
                        if (yearInput) {
                            yearInput.value = today.getFullYear();
                        }


                        const cursadaInput = document.getElementById('asistencia_cursada');
                        const labelCursada = document.querySelector('label[for="asistencia_cursada"]');
                        if (labelCursada) {

                            //labelCursada.style.display = 'none';
                        }
                        if (cursadaInput) {  //aqui evaluo la tec id de la posicion donde estoy y guardo en el input 
                            cursadaInput.value = cursadaId;
                            cursadaInput.setAttribute('readonly', true); // Hacerlo solo lectura -suele no dar resultado al ser opciones desplegadas-
                            cursadaInput.style.display = 'none'; //ocultar el campo evitando que se edite por el usuario
                        }
                
                    })  
                    .catch(error => console.error('Error al cargar el formulario de edici칩n:', error));
            }

        </script>



        {# script asistencias #}


        <script>
            function openModal1(notaId, cursoId, campo) {
                // Generar la URL con los IDs correctos
                const url = "{{ path('editar_nota', { 'id': '__id__', 'curso_id': '__cursoId__' }) }}"
                    .replace('__id__', notaId)
                    .replace('__cursoId__', cursoId);
                // Realizar la solicitud fetch
                fetch(url)
                    .then(response => response.text())
                    .then(html => {
                        document.getElementById('modalBody-1').innerHTML = html;
                        document.getElementById('Modal1').style.display = 'block';
                        
                        // Ocultar campos seg칰n el par치metro 'campo'
                        const campos = ['parcial', 'recuperatorio1', 'parcial2', 'recuperatorio2'];
                        campos.forEach(c => {
                            const label = document.querySelector(`label[for="nota_${c}"]`);
                            const input = document.getElementById(`nota_${c}`);
                            if (c !== campo) {
                                if (label) label.style.display = 'none';
                                if (input) input.style.display = 'none';
                            }
                        });
                    })  
                    .catch(error => console.error('Error al cargar el formulario de edici칩n:', error));
            }

            function closeModal1() {
                document.getElementById('Modal1').style.display = 'none';
                document.getElementById('modalBody-1').innerHTML = ''; // Restablecer el contenido del modal
            }

           let asistenciasMarcadas = {};

           document.addEventListener('keydown', function (event) {
            // Solo continua si alguna de las dos variables est치 activada
            if (!VistaAsistenciaActiva && !ActivarEditar) return;
        
            switch (event.key) {
                case 'ArrowLeft': // Flecha izquierda para retroceder al alumno anterior
                    document.getElementById('anterior').click();
                    break;
        
                case 'ArrowRight': // Flecha derecha para avanzar al siguiente alumno
                    avanzarSiEsPosible();
                    break;
        
                case 'F1': // F1 para marcar como "Presente"
                    event.preventDefault();
                    if (VistaAsistenciaActiva || ActivarEditar) {  // Verifica si alguna est치 activa
                        actualizarEstado('Presente', true);  // Actualiza el estado a 'Presente' y guarda
                        setTimeout(() => {
                            if (!ActivarEditar) {  // Verifica si ActivarEditar es false
                                avanzarSiEsPosible();  // Avanza al siguiente alumno
                            } else {
                                ActivarEditar = false;  // Cambia ActivarEditar a false
                                cerrarPasarAsistenciaModal();  // Cierra el modal
                                console.log('ActivarEditar:', ActivarEditar);  // Verifica el valor de ActivarEditar
                            }
                        }, 1000);
                    }
                    break;
        
                case 'F2': // F2 para marcar como "Ausente"
                    event.preventDefault();
                    if (VistaAsistenciaActiva || ActivarEditar) {  // Verifica si alguna est치 activa
                        actualizarEstado('Ausente', true);  // Actualiza el estado a 'Ausente' y guarda
                        setTimeout(() => {
                            if (!ActivarEditar) {  // Verifica si ActivarEditar es false
                                avanzarSiEsPosible();  // Avanza al siguiente alumno
                            } else {
                                ActivarEditar = false;  // Cambia ActivarEditar a false
                                cerrarPasarAsistenciaModal();  // Cierra el modal
                            }
                        }, 1000);
                    }
                    break;
        
                case 'F3': // F3 para marcar como "Media falta"
                    event.preventDefault();
                    if (VistaAsistenciaActiva || ActivarEditar) {  // Verifica si alguna est치 activa
                        actualizarEstado('Media falta', true);  // Actualiza el estado a 'Media falta' y guarda
                        setTimeout(() => {
                            if (!ActivarEditar) {  // Verifica si ActivarEditar es false
                                avanzarSiEsPosible();  // Avanza al siguiente alumno
                            } else {
                                ActivarEditar = false;  // Cambia ActivarEditar a false
                                cerrarPasarAsistenciaModal();  // Cierra el modal
                            }
                        }, 1000);
                    }
                    break;
        
                case 'F4': // F4 para marcar como "Justificada"
                    event.preventDefault();
                    if (VistaAsistenciaActiva || ActivarEditar) {  // Verifica si alguna est치 activa
                        actualizarEstado('Justificada', false); // No guarda autom치ticamente
                        document.getElementById('observacion').style.visibility = 'visible';
                        document.getElementById('enviar').style.visibility = 'visible';
                    }
                    break;
            }
        });
        

// Funci칩n para actualizar el estado del alumno
function actualizarEstado(estado, guardar = true) {
    const spanEstado = document.querySelector('.estado-text');
    spanEstado.textContent = estado;
    spanEstado.className = 'estado-text estado-' + estado.toLowerCase().replace(' ', '');

    const alumnoId = cursosData[selectedCursoId].cursadas[indiceActual].alumno.id;
    let observacion = document.getElementById('observacion-input').value || '';

    if (estado === 'Justificada') {
        document.getElementById('observacion').style.visibility = 'visible';
        document.getElementById('enviar').style.visibility = 'visible';
    } else {
        document.getElementById('observacion').style.visibility = 'hidden';
        document.getElementById('enviar').style.visibility = 'hidden';
        observacion = '';
    }

    // Guarda el estado y la observaci칩n en asistenciasMarcadas
    asistenciasMarcadas[alumnoId] = {
        cursada_id: cursosData[selectedCursoId].cursadas[indiceActual].id,
        fecha: new Date().toISOString().split('T')[0], // Fecha actual en formato yyyy-mm-dd
        estado: estado,
        observacion: observacion
    };

    if (guardar) {
        guardarAsistencias();
        const confirmacion = document.getElementById('confirmacion');
        confirmacion.style.visibility = 'visible';
        confirmacion.textContent = '九 Datos guardados correctamente';
        setTimeout(() => {
            confirmacion.style.visibility = 'hidden';
        }, 2000);
    }

    // Actualiza el contador de alumnos presentes
    actualizarContadorPresentes();
}

// Funci칩n para guardar las asistencias marcadas
function guardarAsistencias() {
    const urlGuardar = "{{ path('guardar_asistencia') }}";

    fetch(urlGuardar, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(Object.values(asistenciasMarcadas)),
    })
    .then(response => {
        if (response.ok) {
            console.log('Datos guardados correctamente');
            // Actualiza los datos en el frontend
            fetch(`/local/public/index.php/actualizar-lista-alumnos/${selectedCursoId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Error al obtener los datos actualizados');
                    }
                    return response.json();
                })
                .then(data => {
                    // Actualiza cursosData con los datos m치s recientes
                    cursosData[selectedCursoId].cursadas = data.map(cursada => ({
                        id: cursada.id,
                        alumno: {
                            id: cursada.id,
                            nombre: cursada.nombre,
                            apellido: cursada.apellido,
                            dni: cursada.dni,
                        },
                        asistencias: [
                            {
                                asistencia: cursada.asistencia,
                                observacion: cursada.observacion,
                            },
                        ],
                    }));

                    // Actualiza la tabla de alumnos
                    const tbody = document.querySelector('.curso-tabla tbody');
                    tbody.innerHTML = ''; // Limpia la tabla antes de agregar nuevas filas

                    data.forEach(alumno => {
                        const row = document.createElement('tr');
                        row.classList.add('fila-alumno');

                        row.innerHTML = `
                            <td class="alumno-nombre">${alumno.nombre}</td>
                            <td class="alumno-apellido">${alumno.apellido}</td>
                            <td class="alumno-dni">${alumno.dni}</td>
                            <td class="alumno-asistencia">
                                <span class="estado-asistencia ${alumno.asistencia.toLowerCase()}">
                                    ${alumno.asistencia}
                                </span>
                            </td>
                            <td class="alumno-observacion">${alumno.observacion}</td>
                            <td class="alumnoeditar">
                                <button onclick="ActivarEstadoEditar();editarAsistencia(${selectedCursoId}, ${alumno.id})">Editar</button>
                            </td>
                        `;

                        tbody.appendChild(row);
                    });

                    console.log('Tabla actualizada con los datos m치s recientes.');

                    // Actualiza el contador de alumnos presentes
                    actualizarContadorPresentes();
                })
                .catch(error => console.error('Error al actualizar cursosData:', error));
        } else {
            response.text().then(text => console.error("Error al guardar:", text));
        }
    })
    .catch(error => console.error('Error en la petici칩n:', error));
}

function actualizarContadorPresentes() {
    const filas = document.querySelectorAll('.curso-tabla tbody .fila-alumno');
    let presentes = 0;

    filas.forEach(fila => {
        const estadoElemento = fila.querySelector('.estado-asistencia');
        if (estadoElemento) {
            const estado = estadoElemento.textContent.trim().toLowerCase();
            if (estado === 'presente') {
                presentes++;
            }
        }
    });

    const totalPresentes = document.querySelector('.total-presentes');
    if (totalPresentes) {
        totalPresentes.textContent = `Alumnos presentes: ${presentes}`;
    }
}
document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('enviar').addEventListener('click', () => {
        actualizarEstado('Justificada', true); // Actualiza el estado a "Justificada" y guarda
        setTimeout(() => {
            if (!ActivarEditar) {  // Verifica si ActivarEditar es false
                avanzarSiEsPosible();  // Avanza al siguiente alumno
            } else {
                cerrarPasarAsistenciaModal();  // Cierra el modal
                ActivarEditar = false;  // Cambia ActivarEditar a false
                console.log('ActivarEditar desactivado:', ActivarEditar);  // Verifica el valor de ActivarEditar
            }
        }, 1000);
    });
});

document.addEventListener('DOMContentLoaded', () => {
    const fechaActualElemento = document.getElementById('fecha-actual');
    if (fechaActualElemento) {
        const hoy = new Date();
        const dia = String(hoy.getDate()).padStart(2, '0');
        const mes = String(hoy.getMonth() + 1).padStart(2, '0');
        const anio = hoy.getFullYear();
        fechaActualElemento.textContent = `Fecha: ${dia}/${mes}/${anio}`;
    }
});



document.addEventListener('DOMContentLoaded', () => {
    // Selecciona los campos de b칰squeda
    const dniBuscar = document.getElementById('dni-buscar');
    const nombreBuscar = document.getElementById('nombre-buscar');
    const apellidoBuscar = document.getElementById('apellido-buscar');

    // Agrega eventos de entrada (input) a cada campo
    dniBuscar.addEventListener('input', filtrarAlumnos);
    nombreBuscar.addEventListener('input', filtrarAlumnos);
    apellidoBuscar.addEventListener('input', filtrarAlumnos);

    function filtrarAlumnos() {
        // Obt칠n los valores de los campos de b칰squeda
        const dniValor = dniBuscar.value.toLowerCase();
        const nombreValor = nombreBuscar.value.toLowerCase();
        const apellidoValor = apellidoBuscar.value.toLowerCase();

        // Selecciona todas las filas de la tabla de alumnos
        const filas = document.querySelectorAll('.curso-tabla tbody .fila-alumno');

        // Itera sobre cada fila y verifica si coincide con los criterios de b칰squeda
        filas.forEach(fila => {
            const dni = fila.querySelector('.alumno-dni').textContent.toLowerCase();
            const nombre = fila.querySelector('.alumno-nombre').textContent.toLowerCase();
            const apellido = fila.querySelector('.alumno-apellido').textContent.toLowerCase();

            // Verifica si la fila coincide con los valores de b칰squeda
            if (
                (dni.includes(dniValor) || dniValor === '') &&
                (nombre.includes(nombreValor) || nombreValor === '') &&
                (apellido.includes(apellidoValor) || apellidoValor === '')
            ) {
                fila.style.display = ''; // Muestra la fila si coincide
            } else {
                fila.style.display = 'none'; // Oculta la fila si no coincide
            }
        });
    }
});

        </script>

        <!-- Modal1 para asignar notas a las materias de un docente!!!-->
        <div id="Modal1" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-content21">
                    <span class="close" onclick="closeModal1()">&times;</span>
                    <div id="modalBody-1" class="submodal"></div>
                </div>
            </div>    
        </div>

        <!-- Modal2 para asignar Asistencias!!!-->
        <div id="Modal2" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-content21">
                    <span class="close" onclick="closeModal2()">&times;</span>
                    <div id="modalBody-2" class="submodal"></div>
                </div>
            </div>    
        </div>
           <div id="spa-overlay"></div>
    <div id="spa-content">
    </div>




        {# --- Modal de Pasar Lista, inicialmente oculto --- #}
        <div id="spa-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:999;"></div>
        
        <div id="PasarAsistenciaModal" class="AsistenciaModal1" style="display: none;">
            <div id="alumno-container">
                <div class="alumno-card">
                    <div class="fecha-actual" id="fecha-actual"></div>
                    <h2 class="AlumnoNombre">Nombre Apellido</h2>
                    <p class="AlumnoDni">DNI: 12345678</p>
                    <p id="estado">
                        Estado: <span class="estado-text estado-neutral">No marcado</span>
                    </p>
                    <p id="observacion" style="visibility: hidden;">
                        Observaci칩n: <input type="text" id="observacion-input" placeholder="Completar...">
                    </p>
                    <button id="enviar" style="visibility: hidden;" class="btn btn-primary mt-2">Guardar</button>
                    <p id="confirmacion" style="visibility: hidden; color: green; margin-top: 10px;">
                        九 Datos guardados correctamente
                    </p>
                </div>
            </div>
        
            <div class="botones mt-3">
                <button id="anterior">拘勇</button>
                <button id="presente">九 Presente (F1)</button>
                <button id="ausente">仇 Ausente (F2)</button>
                <button id="mediafalta">낍 Media falta (F3)</button>
                <button id="justificada">游늯九 Justificada (F4)</button>
                <button id="siguiente">俱뫮잺</button>
            </div>
        </div>



        <button id="backButton" style="display: none;" class="btn-primary">VOLVER</button>
    
   
    
{% endblock %}